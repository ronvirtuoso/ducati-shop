define(["jquery","jquery/jquery.cookie",'Magento_Ui/js/modal/modal',"mage/url"],function($,cookie,modal,url){"use strict";let countries={cookieName:'ducati-country-selection',dataSelector:'country-code',countrySwitchers:{desktop:'#storeswitcher-desktop',mobile:'#switch-store-mobile'},newsletterCountry:'#country-newsletter',select:'.custom-select',customSelect:'.country-custom-select',init:function(){this.addOnCountryClickEvent();},addOnCountryClickEvent:function(){let self=this;$('*[data-'+this.dataSelector+']').on('click',function(){self.setCookie(this)});},setCookie:function(country){let cookieValue={countryCode:$(country).data(this.dataSelector),countryText:$(country).text()};$.cookie(this.cookieName,JSON.stringify(cookieValue),{path:'/'})},changeCountryFromCookie:function(){let cookieValue=JSON.parse($.cookie(this.cookieName))
if(cookieValue!=null){this.changeCountry(cookieValue.countryCode,cookieValue.countryText)
this.changeNewsletterCountry(cookieValue.countryCode)}},changeCountry:function(countryCode,labelText){$.each(this.countrySwitchers,function(switcher,switcherValue){let storeSwitcher=$(switcherValue);let $flag=storeSwitcher.find('.country-flag');$flag.removeClass().addClass('country-flag country-flag-bg-'+countryCode);storeSwitcher.find('.label').text(labelText);});},changeNewsletterCountry:function(countryCode){let liToSwitch=$('#pretty-country-custom-select ul li[data-option-country-code="'
+countryCode.toUpperCase()+'"]');this.switchLi(liToSwitch)},changeSelect:function(){let self=this;$(this.customSelect).each(function(index,element){$(this).parent().after().append("<div class='custom-select' id='pretty-country-custom-select'>"+"<div class='selectedOption' data-selected-option=''></div><ul></ul></div>");$(element).each(function(idx,elm){$('option',elm).each(function(id,el){$(self.select+' ul:last').append('<li data-option-country-code="'+el.value+'">'+el.text+'</li>');});$(self.select+' ul').hide();$(self.customSelect).children('div.selectedOption').text("Select");});$(self.select+':last').children('div.selectedOption').text("Select");});this.optionOnClickEvent();this.customSelectOnClickEvent();this.displayCountryCustomSelect();},switchLi(li){$(li).siblings().not(this).css('opacity','1');$(li).css('opacity','0.3');$(li).parent().prev('.selectedOption').text($(li).text());$(li).parent().prev('.selectedOption').attr('data-selected-option',$(li).data('option-country-code'));},optionOnClickEvent(){$('.selectedOption').on('click',function(ev){$(this).next('ul').slideToggle(200);$('.selectedOption').not(this).next('ul').hide();$(this).parent('.custom-select').toggleClass('open');});},customSelectOnClickEvent(){let self=this;$(this.select+' ul li').on('click',function(ev){self.switchLi($(this));$(this).parent('ul').hide();$(this).parents('.custom-select').toggleClass('open');$(window).trigger('pretty-change',[this]);});},displayCountryCustomSelect(){$(this.select).show();$(this.customSelect).hide();},changeHeaderCountry(){var options={type:'popup',responsive:true,innerScroll:true,modalClass:'country-modal-container',buttons:[{text:$.mage.__('x'),class:'',click:function(){this.closeModal();}}]};let popup=modal(options,$('#country-modal'));},replaceRegions:function(newRegions){let stateSelect=$('#state');let stateInput=$('#region');if(newRegions.length===0){$(stateSelect).hide();$(stateInput).show();}else{$(stateSelect).show();$(stateInput).hide();$(stateSelect).find('option').remove();$.each(newRegions,function(index,value){$(stateSelect).append(new Option(value['label'],value['value']));})}},highlightCountry:function(){let $urlSplit=window.location.href.split('/')[3];let $urlCode=$urlSplit.split('_')[0];$(".switch-link").each(function(index,element){let $countryCode=$(this).data('country-code');if($countryCode===$urlCode){$(this).addClass('highlight');}});},highlightLanguage:function(){let $urlSplitFinal=window.location.href.split('/')[4];$(".languages .switch-link").each(function(index,element){let $languageCode=$(this).data('language-locale');let $languageCodeFinal=$languageCode.substr($languageCode.length-2);if($languageCodeFinal===$urlSplitFinal){$(this).addClass('highlight');}});}};$(document).ready(function(){countries.changeHeaderCountry();countries.changeSelect();countries.changeCountryFromCookie();countries.highlightCountry();countries.highlightLanguage();$("#sw-duplicate").on('click',function(){$("#country-modal").modal("openModal");});$("#sw-duplicate-mobile").on('click',function(){$("#country-modal").modal("openModal");});if(window.matchMedia("(max-width: 1139px)").matches){setTimeout(function(){let $clone=$('.d-login').hide().clone();$('.dx').append($clone.show());},10);}});$(document).on('change','#country',function(){var countryVal=$('#country').val();let countryChangeUrl=url.build('/ducati/contact/countrychange?country='+countryVal);$.ajax({url:countryChangeUrl,type:"GET",dataType:'json',cache:true,jsonp:false,showLoader:true,error:function(xhr,status,errorThrown){console.error('Error: '+errorThrown);}}).done(function(data){if(data.success){countries.replaceRegions(data.regions);}else{console.error('Error: '+data.error);}});});return countries.init();})